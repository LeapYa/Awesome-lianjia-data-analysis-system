(function(){"use strict";var e={3620:function(e,a,t){var l=t(7657),s=t(641),n=t(33);const o={class:"app"},r={class:"sidebar"},i={class:"logo"},c={class:"footer"};function u(e,a,t,u,d,k){const p=(0,s.g2)("router-link"),v=(0,s.g2)("Home"),y=(0,s.g2)("el-icon"),g=(0,s.g2)("el-menu-item"),m=(0,s.g2)("List"),h=(0,s.g2)("Document"),f=(0,s.g2)("DataAnalysis"),b=(0,s.g2)("Key"),_=(0,s.g2)("el-menu"),C=(0,s.g2)("el-aside"),F=(0,s.g2)("el-header"),L=(0,s.g2)("router-view"),w=(0,s.g2)("el-main"),W=(0,s.g2)("el-footer"),x=(0,s.g2)("el-container");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.bF)(C,{width:"240px"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",r,[(0,s.Lk)("div",i,[(0,s.bF)(p,{to:"/"},{default:(0,s.k6)((()=>a[0]||(a[0]=[(0,s.Lk)("h1",null,"租房数据分析系统",-1)]))),_:1})]),(0,s.bF)(_,{"default-active":u.activeIndex,class:"sidebar-menu",router:"","background-color":"#304156","text-color":"#fff","active-text-color":"#409EFF"},{default:(0,s.k6)((()=>[(0,s.bF)(g,{index:"/"},{default:(0,s.k6)((()=>[(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(v)])),_:1}),a[1]||(a[1]=(0,s.Lk)("span",null,"首页",-1))])),_:1}),(0,s.bF)(g,{index:"/tasks"},{default:(0,s.k6)((()=>[(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(m)])),_:1}),a[2]||(a[2]=(0,s.Lk)("span",null,"爬虫任务",-1))])),_:1}),(0,s.bF)(g,{index:"/houses"},{default:(0,s.k6)((()=>[(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(h)])),_:1}),a[3]||(a[3]=(0,s.Lk)("span",null,"房源数据",-1))])),_:1}),(0,s.bF)(g,{index:"/analysis"},{default:(0,s.k6)((()=>[(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(f)])),_:1}),a[4]||(a[4]=(0,s.Lk)("span",null,"数据分析",-1))])),_:1}),(0,s.bF)(g,{index:"/captcha"},{default:(0,s.k6)((()=>[(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(b)])),_:1}),a[5]||(a[5]=(0,s.Lk)("span",null,"验证码代理",-1))])),_:1})])),_:1},8,["default-active"])])])),_:1}),(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.bF)(F,{height:"60px"},{default:(0,s.k6)((()=>a[6]||(a[6]=[(0,s.Lk)("div",{class:"header-content"},[(0,s.Lk)("div",{class:"breadcrumb"}),(0,s.Lk)("div",{class:"user-info"})],-1)]))),_:1}),(0,s.bF)(w,null,{default:(0,s.k6)((()=>[(0,s.bF)(L,null,{default:(0,s.k6)((({Component:e})=>[(0,s.bF)(l.eB,{name:"fade",mode:"out-in"},{default:(0,s.k6)((()=>[((0,s.uX)(),(0,s.Wv)((0,s.$y)(e)))])),_:2},1024)])),_:1})])),_:1}),(0,s.bF)(W,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",c,[(0,s.Lk)("p",null,"© "+(0,n.v_)(u.currentYear)+" 租房数据分析系统 | 基于贝壳网的租房数据爬取和分析平台",1)])])),_:1})])),_:1})])),_:1})])}var d=t(5220),k=t(8548),p={name:"App",components:{Home:k.Home,List:k.List,Document:k.Document,DataAnalysis:k.DataAnalysis,Key:k.Key},setup(){const e=(0,d.lq)(),a=(0,s.EW)((()=>e.path)),t=(new Date).getFullYear();return{activeIndex:a,currentYear:t}}},v=t(6262);const y=(0,v.A)(p,[["render",u]]);var g=y;const m={class:"home"},h={class:"system-intro"},f={class:"feature-header"},b={class:"feature-header"},_={class:"feature-header"},C={class:"card-header"},F={key:0},L={class:"task-info"},w={class:"task-actions"};function W(e,a,t,l,o,r){const i=(0,s.g2)("el-col"),c=(0,s.g2)("el-row"),u=(0,s.g2)("Download"),d=(0,s.g2)("el-icon"),k=(0,s.g2)("el-card"),p=(0,s.g2)("DataAnalysis"),v=(0,s.g2)("PieChart"),y=(0,s.g2)("router-link"),g=(0,s.g2)("CrawlTaskForm"),W=(0,s.g2)("el-button"),x=(0,s.g2)("el-tag"),K=(0,s.g2)("el-empty"),S=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)("div",m,[(0,s.bF)(c,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(i,{span:24},{default:(0,s.k6)((()=>a[0]||(a[0]=[(0,s.Lk)("div",{class:"welcome-section"},[(0,s.Lk)("h1",null,"租房数据分析系统"),(0,s.Lk)("p",{class:"subtitle"},"基于贝壳网的租房数据爬取和分析平台")],-1)]))),_:1})])),_:1}),(0,s.bF)(c,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(i,{span:16},{default:(0,s.k6)((()=>[(0,s.bF)(k,{class:"intro-card"},{header:(0,s.k6)((()=>a[1]||(a[1]=[(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("h2",null,"系统功能介绍")],-1)]))),default:(0,s.k6)((()=>[(0,s.Lk)("div",h,[a[16]||(a[16]=(0,s.Lk)("p",null,"本系统是一个基于Python技术栈开发的租房数据分析平台，通过爬取贝壳网的租房信息，并使用PySpark进行数据处理和分析，最终以可视化图表的形式展示市场洞察。",-1)),a[17]||(a[17]=(0,s.Lk)("h3",null,"主要功能:",-1)),(0,s.bF)(c,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(i,{span:8},{default:(0,s.k6)((()=>[(0,s.bF)(k,{shadow:"hover",class:"feature-card"},{header:(0,s.k6)((()=>[(0,s.Lk)("div",f,[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.bF)(u)])),_:1}),a[2]||(a[2]=(0,s.Lk)("span",null,"数据采集",-1))])])),default:(0,s.k6)((()=>[a[3]||(a[3]=(0,s.Lk)("p",null,"支持多城市租房数据爬取，自动解析房源价格、面积、位置等关键信息",-1))])),_:1})])),_:1}),(0,s.bF)(i,{span:8},{default:(0,s.k6)((()=>[(0,s.bF)(k,{shadow:"hover",class:"feature-card"},{header:(0,s.k6)((()=>[(0,s.Lk)("div",b,[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.bF)(p)])),_:1}),a[4]||(a[4]=(0,s.Lk)("span",null,"数据分析",-1))])])),default:(0,s.k6)((()=>[a[5]||(a[5]=(0,s.Lk)("p",null,"使用PySpark对租房数据进行多维度分析，包括区域分析、户型分析、价格分布等",-1))])),_:1})])),_:1}),(0,s.bF)(i,{span:8},{default:(0,s.k6)((()=>[(0,s.bF)(k,{shadow:"hover",class:"feature-card"},{header:(0,s.k6)((()=>[(0,s.Lk)("div",_,[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.bF)(v)])),_:1}),a[6]||(a[6]=(0,s.Lk)("span",null,"可视化展示",-1))])])),default:(0,s.k6)((()=>[a[7]||(a[7]=(0,s.Lk)("p",null,"通过ECharts图表直观展示分析结果，帮助用户快速了解租房市场情况",-1))])),_:1})])),_:1})])),_:1}),a[18]||(a[18]=(0,s.Lk)("h3",null,"快速开始:",-1)),(0,s.Lk)("ol",null,[a[14]||(a[14]=(0,s.Lk)("li",null,"在右侧创建新的爬虫任务，选择城市和爬取页数",-1)),(0,s.Lk)("li",null,[a[9]||(a[9]=(0,s.eW)("等待爬虫任务完成后，在")),(0,s.bF)(y,{to:"/tasks"},{default:(0,s.k6)((()=>a[8]||(a[8]=[(0,s.eW)("任务列表")]))),_:1}),a[10]||(a[10]=(0,s.eW)("中查看详情"))]),a[15]||(a[15]=(0,s.Lk)("li",null,'点击"查看数据"浏览爬取的房源信息，或点击"分析数据"进行数据分析',-1)),(0,s.Lk)("li",null,[a[12]||(a[12]=(0,s.eW)("在")),(0,s.bF)(y,{to:"/analysis"},{default:(0,s.k6)((()=>a[11]||(a[11]=[(0,s.eW)("数据分析")]))),_:1}),a[13]||(a[13]=(0,s.eW)("页面查看生成的可视化图表"))])])])])),_:1})])),_:1}),(0,s.bF)(i,{span:8},{default:(0,s.k6)((()=>[(0,s.bF)(g,{onTaskCreated:l.handleTaskCreated},null,8,["onTaskCreated"]),(0,s.bo)(((0,s.uX)(),(0,s.Wv)(k,{class:"latest-tasks"},{header:(0,s.k6)((()=>[(0,s.Lk)("div",C,[a[20]||(a[20]=(0,s.Lk)("h3",null,"最近爬虫任务",-1)),(0,s.bF)(W,{type:"primary",link:"",onClick:l.goToTaskList},{default:(0,s.k6)((()=>a[19]||(a[19]=[(0,s.eW)("查看全部")]))),_:1},8,["onClick"])])])),default:(0,s.k6)((()=>[l.recentTasks.length>0?((0,s.uX)(),(0,s.CE)("div",F,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.recentTasks,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"task-item"},[(0,s.Lk)("div",L,[(0,s.Lk)("h4",null,(0,n.v_)(e.city),1),(0,s.Lk)("p",null,[a[21]||(a[21]=(0,s.eW)(" 状态: ")),(0,s.bF)(x,{type:l.getStatusType(e.status),size:"small"},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(e.status),1)])),_:2},1032,["type"])]),(0,s.Lk)("p",null,"开始时间: "+(0,n.v_)(l.formatDate(e.start_time)),1),(0,s.Lk)("p",null,"房源数: "+(0,n.v_)(e.success_items)+"/"+(0,n.v_)(e.total_items),1)]),(0,s.Lk)("div",w,[(0,s.bF)(W,{type:"primary",size:"small",onClick:a=>l.viewTaskDetail(e),disabled:"进行中"===e.status},{default:(0,s.k6)((()=>a[22]||(a[22]=[(0,s.eW)(" 查看 ")]))),_:2},1032,["onClick","disabled"])])])))),128))])):((0,s.uX)(),(0,s.Wv)(K,{key:1,description:"暂无爬虫任务"}))])),_:1})),[[S,l.loading]])])),_:1})])),_:1})])}t(4114);var x=t(953),K=t(163);const S={class:"crawl-task-form"};function I(e,a,t,l,n,o){const r=(0,s.g2)("el-option"),i=(0,s.g2)("el-select"),c=(0,s.g2)("el-form-item"),u=(0,s.g2)("el-input-number"),d=(0,s.g2)("el-button"),k=(0,s.g2)("el-form"),p=(0,s.g2)("el-card");return(0,s.uX)(),(0,s.CE)("div",S,[(0,s.bF)(p,{class:"task-card"},{header:(0,s.k6)((()=>a[2]||(a[2]=[(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("h3",null,"创建新爬虫任务")],-1)]))),default:(0,s.k6)((()=>[(0,s.bF)(k,{model:l.form,"label-width":"120px",rules:l.rules,ref:"taskForm"},{default:(0,s.k6)((()=>[(0,s.bF)(c,{label:"城市",prop:"city"},{default:(0,s.k6)((()=>[(0,s.bF)(i,{modelValue:l.form.city,"onUpdate:modelValue":a[0]||(a[0]=e=>l.form.city=e),placeholder:"请选择城市",style:{width:"100%"}},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.cities,((e,a)=>((0,s.uX)(),(0,s.Wv)(r,{key:a,label:a,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(c,{label:"爬取页数",prop:"maxPages"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{modelValue:l.form.maxPages,"onUpdate:modelValue":a[1]||(a[1]=e=>l.form.maxPages=e),min:1,max:50,style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,s.bF)(c,null,{default:(0,s.k6)((()=>[(0,s.bF)(d,{type:"primary",onClick:l.submitForm,loading:l.loading},{default:(0,s.k6)((()=>a[3]||(a[3]=[(0,s.eW)("开始爬取")]))),_:1},8,["onClick","loading"]),(0,s.bF)(d,{onClick:l.resetForm},{default:(0,s.k6)((()=>a[4]||(a[4]=[(0,s.eW)("重置")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])),_:1})])}var T=t(4335);const X=T.A.create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json"},withCredentials:!1});X.interceptors.request.use((e=>e),(e=>(console.error("请求错误:",e),Promise.reject(e)))),X.interceptors.response.use((e=>e.data),(e=>(console.error("响应错误:",e),Promise.reject(e))));var D={getCities(){return X.get("/cities")},createCrawlTask(e){return X.post("/tasks/crawl",e)},getTasks(e){return X.get("/tasks",{params:e})},getTaskById(e){return X.get(`/tasks/${e}`)},getHouses(e){return X.get("/houses",{params:e})},getHouseCount(e){return X.get("/houses/count",{params:e})},getHouseById(e){return X.get(`/houses/${e}`)},runAnalysis(e){return X.post("/analysis/run",e)},getAnalysisResults(e){return X.get("/analysis/results",{params:e})},getAnalysisResultById(e){return X.get(`/analysis/results/${e}`)},getAnalysisTypes(){return X.get("/analysis/types")},getDistricts(e){return X.get("/districts",{params:{city:e}})},getSummaryStatistics(e){return X.get("/statistics/summary",{params:{city:e}})}},R={name:"CrawlTaskForm",emits:["task-created"],setup(e,{emit:a}){const t=(0,x.Kh)({city:"",maxPages:5}),l={city:[{required:!0,message:"请选择城市",trigger:"change"}],maxPages:[{required:!0,message:"请设置爬取页数",trigger:"blur"}]},n=(0,x.KR)({}),o=(0,x.KR)(null),r=(0,x.KR)(!1),i=async()=>{try{n.value=await D.getCities()}catch(e){K.nk.error("获取城市列表失败"),console.error(e)}},c=async()=>{o.value&&await o.value.validate((async e=>{if(e)try{r.value=!0;const e={city:t.city,max_pages:t.maxPages},l=await D.createCrawlTask(e);r.value=!1,K.nk.success("爬虫任务创建成功"),a("task-created",l),u()}catch(l){r.value=!1,K.nk.error("爬虫任务创建失败"),console.error(l)}}))},u=()=>{o.value&&o.value.resetFields()};return(0,s.sV)((()=>{i()})),{form:t,rules:l,cities:n,taskForm:o,loading:r,submitForm:c,resetForm:u}}};const E=(0,v.A)(R,[["render",I],["__scopeId","data-v-5c5859a5"]]);var M=E,$={name:"HomeView",components:{CrawlTaskForm:M},setup(){const e=(0,d.rd)(),a=(0,x.KR)(!1),t=(0,x.KR)([]),l=async()=>{try{a.value=!0;const e={limit:5,offset:0};t.value=await D.getTasks(e),a.value=!1}catch(e){a.value=!1,K.nk.error("获取最近任务失败"),console.error(e)}},n=e=>{K.nk.success(`成功创建爬虫任务：${e.city}`),l()},o=()=>{e.push({name:"taskList"})},r=a=>{e.push({name:"houseList",query:{taskId:a.id,city:a.city}})},i=e=>{switch(e){case"进行中":case"In Progress":return"warning";case"完成":case"Completed":return"success";case"失败":case"Failed":return"danger";default:return"info"}},c=e=>{if(!e)return"";const a=new Date(e);return a.toLocaleString()};return(0,s.sV)((()=>{l()})),{loading:a,recentTasks:t,handleTaskCreated:n,goToTaskList:o,viewTaskDetail:r,getStatusType:i,formatDate:c}}};const P=(0,v.A)($,[["render",W],["__scopeId","data-v-e2ec64d6"]]);var A=P;const V={class:"task-list-view"};function z(e,a,t,l,n,o){const r=(0,s.g2)("el-col"),i=(0,s.g2)("el-row"),c=(0,s.g2)("TaskList",!0);return(0,s.uX)(),(0,s.CE)("div",V,[(0,s.bF)(i,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(r,{span:24},{default:(0,s.k6)((()=>a[0]||(a[0]=[(0,s.Lk)("h1",{class:"page-title"},"爬虫任务列表",-1)]))),_:1})])),_:1}),(0,s.bF)(i,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(r,{span:24},{default:(0,s.k6)((()=>[(0,s.bF)(c)])),_:1})])),_:1})])}const q={class:"task-list"},O={class:"card-header"},B={class:"pagination-container"};function U(e,a,t,l,o,r){const i=(0,s.g2)("el-button"),c=(0,s.g2)("el-table-column"),u=(0,s.g2)("el-tag"),d=(0,s.g2)("el-progress"),k=(0,s.g2)("el-table"),p=(0,s.g2)("el-pagination"),v=(0,s.g2)("el-card"),y=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)("div",q,[(0,s.bF)(v,null,{header:(0,s.k6)((()=>[(0,s.Lk)("div",O,[a[1]||(a[1]=(0,s.Lk)("h3",null,"爬虫任务列表",-1)),(0,s.bF)(i,{type:"primary",size:"small",onClick:l.refreshTasks},{default:(0,s.k6)((()=>a[0]||(a[0]=[(0,s.eW)("刷新")]))),_:1},8,["onClick"])])])),default:(0,s.k6)((()=>[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(k,{data:l.tasks,stripe:"",style:{width:"100%"}},{default:(0,s.k6)((()=>[(0,s.bF)(c,{prop:"id",label:"ID",width:"60"}),(0,s.bF)(c,{prop:"city",label:"城市",width:"100"}),(0,s.bF)(c,{prop:"status",label:"状态",width:"100"},{default:(0,s.k6)((e=>[(0,s.bF)(u,{type:l.getStatusType(e.row.status)},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(e.row.status),1)])),_:2},1032,["type"])])),_:1}),(0,s.bF)(c,{prop:"start_time",label:"开始时间",width:"180"},{default:(0,s.k6)((e=>[(0,s.eW)((0,n.v_)(l.formatDate(e.row.start_time)),1)])),_:1}),(0,s.bF)(c,{prop:"end_time",label:"结束时间",width:"180"},{default:(0,s.k6)((e=>[(0,s.eW)((0,n.v_)(e.row.end_time?l.formatDate(e.row.end_time):"-"),1)])),_:1}),(0,s.bF)(c,{prop:"total_items",label:"总条目",width:"100"}),(0,s.bF)(c,{prop:"success_items",label:"成功条目",width:"100"}),(0,s.bF)(c,{label:"进度",width:"180"},{default:(0,s.k6)((e=>[(0,s.bF)(d,{percentage:l.calculateProgress(e.row),status:l.getProgressStatus(e.row.status)},null,8,["percentage","status"])])),_:1}),(0,s.bF)(c,{label:"操作"},{default:(0,s.k6)((e=>[(0,s.bF)(i,{size:"small",type:"primary",onClick:a=>l.viewDetail(e.row),disabled:"进行中"===e.row.status||"In Progress"===e.row.status},{default:(0,s.k6)((()=>a[2]||(a[2]=[(0,s.eW)(" 查看数据 ")]))),_:2},1032,["onClick","disabled"]),(0,s.bF)(i,{size:"small",type:"success",onClick:a=>l.runAnalysis(e.row),disabled:"进行中"===e.row.status||"In Progress"===e.row.status||0===e.row.success_items},{default:(0,s.k6)((()=>a[3]||(a[3]=[(0,s.eW)(" 分析数据 ")]))),_:2},1032,["onClick","disabled"])])),_:1})])),_:1},8,["data"])),[[y,l.loading]]),(0,s.Lk)("div",B,[(0,s.bF)(p,{background:"",layout:"total, sizes, prev, pager, next",total:l.total,"page-size":l.pageSize,"current-page":l.currentPage,"page-sizes":[10,20,50,100],onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["total","page-size","current-page","onSizeChange","onCurrentChange"])])])),_:1})])}var Q={name:"TaskList",setup(){const e=(0,d.rd)(),a=(0,x.KR)([]),t=(0,x.KR)(!1),l=(0,x.KR)(1),n=(0,x.KR)(10),o=(0,x.KR)(0),r=async()=>{try{t.value=!0;const e={limit:n.value,offset:(l.value-1)*n.value},s=await D.getTasks(e);a.value=s,o.value=100,t.value=!1}catch(e){t.value=!1,K.nk.error("获取任务列表失败"),console.error(e)}},i=()=>{r()},c=e=>{l.value=e,r()},u=e=>{n.value=e,l.value=1,r()},k=a=>{"进行中"!==a.status&&"In Progress"!==a.status?e.push({name:"houseList",query:{taskId:a.id,city:a.city}}):K.nk.warning("爬虫任务进行中，暂无法查看数据")},p=async a=>{try{if("进行中"===a.status||"In Progress"===a.status)return void K.nk.warning("爬虫任务进行中，暂无法分析数据");if(0===a.success_items)return void K.nk.warning("没有成功爬取的数据，无法进行分析");t.value=!0;const l={task_id:a.id,city:a.city,analysis_types:[]};await D.runAnalysis(l),t.value=!1,K.nk.success("数据分析任务已启动"),e.push({name:"analysis",query:{city:a.city}})}catch(l){t.value=!1,K.nk.error("启动数据分析任务失败"),console.error(l)}},v=e=>{if(!e.total_items||0===e.total_items)return 0;const a=e.success_items/e.total_items*100;return Math.min(Math.round(a),100)},y=e=>{switch(e){case"进行中":case"In Progress":return"warning";case"完成":case"Completed":return"success";case"失败":case"Failed":return"danger";default:return"info"}},g=e=>{switch(e){case"进行中":case"In Progress":return"";case"完成":case"Completed":return"success";case"失败":case"Failed":return"exception";default:return""}},m=e=>{if(!e)return"";const a=new Date(e);return a.toLocaleString()};return(0,s.sV)((()=>{r()})),{tasks:a,loading:t,currentPage:l,pageSize:n,total:o,refreshTasks:i,handleCurrentChange:c,handleSizeChange:u,viewDetail:k,runAnalysis:p,calculateProgress:v,getStatusType:y,getProgressStatus:g,formatDate:m}}};const H=(0,v.A)(Q,[["render",U],["__scopeId","data-v-51546c60"]]);var j=H,N={name:"TaskListView",components:{TaskList:j}};const Y=(0,v.A)(N,[["render",z],["__scopeId","data-v-c649fae4"]]);var J=Y;const Z={class:"house-list-view"};function G(e,a,t,l,n,o){const r=(0,s.g2)("el-col"),i=(0,s.g2)("el-row"),c=(0,s.g2)("HouseList",!0);return(0,s.uX)(),(0,s.CE)("div",Z,[(0,s.bF)(i,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(r,{span:24},{default:(0,s.k6)((()=>a[0]||(a[0]=[(0,s.Lk)("h1",{class:"page-title"},"房源数据列表",-1)]))),_:1})])),_:1}),(0,s.bF)(i,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(r,{span:24},{default:(0,s.k6)((()=>[(0,s.bF)(c)])),_:1})])),_:1})])}const ee={class:"house-list"},ae={class:"card-header"},te={class:"filter-actions"},le={class:"filter-container"},se={class:"house-detail"},ne=["src"],oe={class:"pagination-container"};function re(e,a,t,l,o,r){const i=(0,s.g2)("el-button"),c=(0,s.g2)("el-option"),u=(0,s.g2)("el-select"),d=(0,s.g2)("el-form-item"),k=(0,s.g2)("el-input-number"),p=(0,s.g2)("el-form"),v=(0,s.g2)("el-col"),y=(0,s.g2)("el-row"),g=(0,s.g2)("el-table-column"),m=(0,s.g2)("el-table"),h=(0,s.g2)("el-pagination"),f=(0,s.g2)("el-card"),b=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)("div",ee,[(0,s.bF)(f,null,{header:(0,s.k6)((()=>[(0,s.Lk)("div",ae,[a[7]||(a[7]=(0,s.Lk)("h3",null,"房源列表",-1)),(0,s.Lk)("div",te,[(0,s.bF)(i,{type:"primary",size:"small",onClick:l.refreshData},{default:(0,s.k6)((()=>a[5]||(a[5]=[(0,s.eW)("刷新")]))),_:1},8,["onClick"]),(0,s.bF)(i,{type:"success",size:"small",onClick:l.exportData},{default:(0,s.k6)((()=>a[6]||(a[6]=[(0,s.eW)("导出数据")]))),_:1},8,["onClick"])])])])),default:(0,s.k6)((()=>[(0,s.Lk)("div",le,[(0,s.bF)(p,{model:l.filters,inline:""},{default:(0,s.k6)((()=>[(0,s.bF)(d,{label:"城市"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{modelValue:l.filters.city,"onUpdate:modelValue":a[0]||(a[0]=e=>l.filters.city=e),placeholder:"选择城市",clearable:"",onChange:l.handleCityChange},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.cities,((e,a)=>((0,s.uX)(),(0,s.Wv)(c,{key:a,label:a,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,s.bF)(d,{label:"区域"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{modelValue:l.filters.district,"onUpdate:modelValue":a[1]||(a[1]=e=>l.filters.district=e),placeholder:"选择区域",clearable:""},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.districts,(e=>((0,s.uX)(),(0,s.Wv)(c,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(d,{label:"价格区间"},{default:(0,s.k6)((()=>[(0,s.bF)(k,{modelValue:l.filters.minPrice,"onUpdate:modelValue":a[2]||(a[2]=e=>l.filters.minPrice=e),placeholder:"最低价",min:0},null,8,["modelValue"]),a[8]||(a[8]=(0,s.Lk)("span",{class:"separator"},"-",-1)),(0,s.bF)(k,{modelValue:l.filters.maxPrice,"onUpdate:modelValue":a[3]||(a[3]=e=>l.filters.maxPrice=e),placeholder:"最高价",min:0},null,8,["modelValue"])])),_:1}),(0,s.bF)(d,{label:"户型"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{modelValue:l.filters.roomCount,"onUpdate:modelValue":a[4]||(a[4]=e=>l.filters.roomCount=e),placeholder:"房间数",clearable:""},{default:(0,s.k6)((()=>[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(5,(e=>(0,s.bF)(c,{key:e,label:`${e}室`,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.bF)(i,{type:"primary",onClick:l.applyFilters},{default:(0,s.k6)((()=>a[9]||(a[9]=[(0,s.eW)("筛选")]))),_:1},8,["onClick"]),(0,s.bF)(i,{onClick:l.resetFilters},{default:(0,s.k6)((()=>a[10]||(a[10]=[(0,s.eW)("重置")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])]),(0,s.bo)(((0,s.uX)(),(0,s.Wv)(m,{data:l.houses,stripe:"",style:{width:"100%"}},{default:(0,s.k6)((()=>[(0,s.bF)(g,{type:"expand"},{default:(0,s.k6)((e=>[(0,s.Lk)("div",se,[(0,s.bF)(y,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(v,{span:8},{default:(0,s.k6)((()=>[(0,s.Lk)("img",{src:e.row.image,alt:"房源图片",class:"house-image"},null,8,ne)])),_:2},1024),(0,s.bF)(v,{span:16},{default:(0,s.k6)((()=>[(0,s.Lk)("p",null,[a[11]||(a[11]=(0,s.Lk)("strong",null,"地址:",-1)),(0,s.eW)(" "+(0,n.v_)(e.row.location_qu)+" "+(0,n.v_)(e.row.location_big)+" "+(0,n.v_)(e.row.location_small),1)]),(0,s.Lk)("p",null,[a[12]||(a[12]=(0,s.Lk)("strong",null,"户型:",-1)),(0,s.eW)(" "+(0,n.v_)(e.row.room),1)]),(0,s.Lk)("p",null,[a[13]||(a[13]=(0,s.Lk)("strong",null,"面积:",-1)),(0,s.eW)(" "+(0,n.v_)(e.row.size)+"㎡",1)]),(0,s.Lk)("p",null,[a[14]||(a[14]=(0,s.Lk)("strong",null,"单价:",-1)),(0,s.eW)(" "+(0,n.v_)(e.row.unit_price)+"元/㎡/月",1)]),(0,s.Lk)("p",null,[a[15]||(a[15]=(0,s.Lk)("strong",null,"朝向:",-1)),(0,s.eW)(" "+(0,n.v_)(e.row.direction),1)]),(0,s.Lk)("p",null,[a[16]||(a[16]=(0,s.Lk)("strong",null,"楼层:",-1)),(0,s.eW)(" "+(0,n.v_)(e.row.floor),1)]),(0,s.Lk)("p",null,[a[17]||(a[17]=(0,s.Lk)("strong",null,"爬取时间:",-1)),(0,s.eW)(" "+(0,n.v_)(l.formatDate(e.row.crawl_time)),1)]),(0,s.bF)(i,{type:"primary",size:"small",onClick:a=>l.openLink(e.row.link)},{default:(0,s.k6)((()=>a[18]||(a[18]=[(0,s.eW)("查看详情")]))),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])])),_:1}),(0,s.bF)(g,{prop:"title",label:"标题","min-width":"250"}),(0,s.bF)(g,{prop:"price",label:"价格(元/月)",width:"120",sortable:""}),(0,s.bF)(g,{prop:"location_qu",label:"区域",width:"100"}),(0,s.bF)(g,{prop:"size",label:"面积(㎡)",width:"100",sortable:""}),(0,s.bF)(g,{prop:"room",label:"户型",width:"120"}),(0,s.bF)(g,{prop:"direction",label:"朝向",width:"100"})])),_:1},8,["data"])),[[b,l.loading]]),(0,s.Lk)("div",oe,[(0,s.bF)(h,{background:"",layout:"total, sizes, prev, pager, next",total:l.total,"page-size":l.pageSize,"current-page":l.currentPage,"page-sizes":[10,20,50,100],onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["total","page-size","current-page","onSizeChange","onCurrentChange"])])])),_:1})])}var ie={name:"HouseList",setup(){const e=(0,d.lq)(),a=(0,x.KR)([]),t=(0,x.KR)(!1),l=(0,x.Kh)({city:"",district:"",minPrice:null,maxPrice:null,roomCount:null}),n=(0,x.KR)({}),o=(0,x.KR)([]),r=(0,x.KR)(1),i=(0,x.KR)(20),c=(0,x.KR)(0),u=async()=>{try{t.value=!0;const e={city:l.city||void 0,district:l.district||void 0,min_price:l.minPrice||void 0,max_price:l.maxPrice||void 0,room_count:l.roomCount||void 0,limit:i.value,offset:(r.value-1)*i.value};a.value=await D.getHouses(e);const s=await D.getHouseCount(e);c.value=s.count,t.value=!1}catch(e){t.value=!1,K.nk.error("获取房源数据失败"),console.error(e)}},k=async()=>{try{n.value=await D.getCities()}catch(e){K.nk.error("获取城市列表失败"),console.error(e)}},p=async e=>{try{if(!e)return void(o.value=[]);o.value=await D.getDistricts(e)}catch(a){K.nk.error("获取区域列表失败"),console.error(a)}};(0,s.wB)((()=>e.query),(e=>{e.city&&(l.city=e.city),e.taskId&&u()}),{immediate:!0});const v=e=>{l.district="",p(e)},y=()=>{u()},g=()=>{r.value=1,u()},m=()=>{const e=l.city;Object.assign(l,{city:e,district:"",minPrice:null,maxPrice:null,roomCount:null}),r.value=1,u()},h=()=>{K.nk.info("导出功能开发中")},f=e=>{window.open(e,"_blank")},b=e=>{r.value=e,u()},_=e=>{i.value=e,r.value=1,u()},C=e=>{if(!e)return"";const a=new Date(e);return a.toLocaleString()};return(0,s.sV)((()=>{k(),e.query.city&&(l.city=e.query.city,p(l.city)),u()})),{houses:a,loading:t,filters:l,cities:n,districts:o,currentPage:r,pageSize:i,total:c,handleCityChange:v,refreshData:y,applyFilters:g,resetFilters:m,exportData:h,openLink:f,handleCurrentChange:b,handleSizeChange:_,formatDate:C}}};const ce=(0,v.A)(ie,[["render",re],["__scopeId","data-v-66dd90f5"]]);var ue=ce,de={name:"HouseListView",components:{HouseList:ue}};const ke=(0,v.A)(de,[["render",G],["__scopeId","data-v-34857a12"]]);var pe=ke;const ve={class:"analysis-view"};function ye(e,a,t,l,n,o){const r=(0,s.g2)("el-col"),i=(0,s.g2)("el-row"),c=(0,s.g2)("AnalysisResults");return(0,s.uX)(),(0,s.CE)("div",ve,[(0,s.bF)(i,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(r,{span:24},{default:(0,s.k6)((()=>a[0]||(a[0]=[(0,s.Lk)("h1",{class:"page-title"},"租房数据分析",-1)]))),_:1})])),_:1}),(0,s.bF)(i,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(r,{span:24},{default:(0,s.k6)((()=>[(0,s.bF)(c)])),_:1})])),_:1})])}const ge={class:"analysis-results"},me={class:"card-header"},he={class:"filter-actions"},fe={key:0,class:"summary-section"},be={key:0,class:"chart-container"},_e={key:0,class:"chart-container"},Ce={key:0,class:"chart-container"},Fe={key:0,class:"chart-container"},Le={key:0,class:"chart-container"},we={key:0,class:"chart-container"};function We(e,a,t,l,o,r){const i=(0,s.g2)("el-option"),c=(0,s.g2)("el-select"),u=(0,s.g2)("el-button"),d=(0,s.g2)("el-card"),k=(0,s.g2)("el-col"),p=(0,s.g2)("el-row"),v=(0,s.g2)("el-empty"),y=(0,s.g2)("el-tab-pane"),g=(0,s.g2)("el-tabs"),m=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)("div",ge,[(0,s.bF)(d,null,{header:(0,s.k6)((()=>[(0,s.Lk)("div",me,[a[3]||(a[3]=(0,s.Lk)("h3",null,"数据分析结果",-1)),(0,s.Lk)("div",he,[(0,s.bF)(c,{modelValue:l.selectedCity,"onUpdate:modelValue":a[0]||(a[0]=e=>l.selectedCity=e),placeholder:"选择城市",clearable:"",onChange:l.handleCityChange},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.cities,((e,a)=>((0,s.uX)(),(0,s.Wv)(i,{key:a,label:a,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),(0,s.bF)(u,{type:"primary",size:"small",onClick:l.refreshData},{default:(0,s.k6)((()=>a[2]||(a[2]=[(0,s.eW)("刷新")]))),_:1},8,["onClick"])])])])),default:(0,s.k6)((()=>[(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",null,[l.summaryData?((0,s.uX)(),(0,s.CE)("div",fe,[(0,s.Lk)("h4",null,"租房市场概览 - "+(0,n.v_)(l.selectedCity||"全部城市"),1),(0,s.bF)(p,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(k,{span:6},{default:(0,s.k6)((()=>[(0,s.bF)(d,{shadow:"hover",class:"stat-card"},{default:(0,s.k6)((()=>[(0,s.Lk)("h2",null,(0,n.v_)(l.summaryData.total_count),1),a[4]||(a[4]=(0,s.Lk)("p",null,"房源总数",-1))])),_:1})])),_:1}),(0,s.bF)(k,{span:6},{default:(0,s.k6)((()=>[(0,s.bF)(d,{shadow:"hover",class:"stat-card"},{default:(0,s.k6)((()=>[(0,s.Lk)("h2",null,(0,n.v_)(l.summaryData.avg_price)+"元/月",1),a[5]||(a[5]=(0,s.Lk)("p",null,"平均租金",-1))])),_:1})])),_:1}),(0,s.bF)(k,{span:6},{default:(0,s.k6)((()=>[(0,s.bF)(d,{shadow:"hover",class:"stat-card"},{default:(0,s.k6)((()=>[(0,s.Lk)("h2",null,(0,n.v_)(l.summaryData.avg_unit_price)+"元/㎡/月",1),a[6]||(a[6]=(0,s.Lk)("p",null,"平均单位租金",-1))])),_:1})])),_:1}),(0,s.bF)(k,{span:6},{default:(0,s.k6)((()=>[(0,s.bF)(d,{shadow:"hover",class:"stat-card"},{default:(0,s.k6)((()=>[(0,s.Lk)("h2",null,(0,n.v_)(l.getTopDistrict()),1),a[7]||(a[7]=(0,s.Lk)("p",null,"热门区域",-1))])),_:1})])),_:1})])),_:1})])):(0,s.Q3)("",!0),(0,s.bF)(g,{modelValue:l.activeTab,"onUpdate:modelValue":a[1]||(a[1]=e=>l.activeTab=e),onTabClick:l.handleTabClick},{default:(0,s.k6)((()=>[(0,s.bF)(y,{label:"区域租金分析",name:"district_analysis"},{default:(0,s.k6)((()=>[l.analysisData.district_analysis?((0,s.uX)(),(0,s.CE)("div",be,a[8]||(a[8]=[(0,s.Lk)("div",{id:"district-price-chart",class:"chart"},null,-1),(0,s.Lk)("div",{id:"district-count-chart",class:"chart"},null,-1)]))):((0,s.uX)(),(0,s.Wv)(v,{key:1,description:"暂无区域租金分析数据"}))])),_:1}),(0,s.bF)(y,{label:"户型租金分析",name:"room_type_analysis"},{default:(0,s.k6)((()=>[l.analysisData.room_type_analysis?((0,s.uX)(),(0,s.CE)("div",_e,a[9]||(a[9]=[(0,s.Lk)("div",{id:"room-type-price-chart",class:"chart"},null,-1),(0,s.Lk)("div",{id:"room-type-count-chart",class:"chart"},null,-1)]))):((0,s.uX)(),(0,s.Wv)(v,{key:1,description:"暂无户型租金分析数据"}))])),_:1}),(0,s.bF)(y,{label:"朝向租金分析",name:"direction_analysis"},{default:(0,s.k6)((()=>[l.analysisData.direction_analysis?((0,s.uX)(),(0,s.CE)("div",Ce,a[10]||(a[10]=[(0,s.Lk)("div",{id:"direction-chart",class:"chart"},null,-1)]))):((0,s.uX)(),(0,s.Wv)(v,{key:1,description:"暂无朝向租金分析数据"}))])),_:1}),(0,s.bF)(y,{label:"楼层租金分析",name:"floor_analysis"},{default:(0,s.k6)((()=>[l.analysisData.floor_analysis?((0,s.uX)(),(0,s.CE)("div",Fe,a[11]||(a[11]=[(0,s.Lk)("div",{id:"floor-chart",class:"chart"},null,-1)]))):((0,s.uX)(),(0,s.Wv)(v,{key:1,description:"暂无楼层租金分析数据"}))])),_:1}),(0,s.bF)(y,{label:"租金分布",name:"price_distribution"},{default:(0,s.k6)((()=>[l.analysisData.price_distribution?((0,s.uX)(),(0,s.CE)("div",Le,a[12]||(a[12]=[(0,s.Lk)("div",{id:"price-distribution-chart",class:"chart"},null,-1)]))):((0,s.uX)(),(0,s.Wv)(v,{key:1,description:"暂无租金分布数据"}))])),_:1}),(0,s.bF)(y,{label:"小区租金分析",name:"community_analysis"},{default:(0,s.k6)((()=>[l.analysisData.community_analysis?((0,s.uX)(),(0,s.CE)("div",we,a[13]||(a[13]=[(0,s.Lk)("div",{id:"community-chart",class:"chart"},null,-1)]))):((0,s.uX)(),(0,s.Wv)(v,{key:1,description:"暂无小区租金分析数据"}))])),_:1})])),_:1},8,["modelValue","onTabClick"])])),[[m,l.loading]])])),_:1})])}t(8111),t(1701);var xe=t(6744),Ke={name:"AnalysisResults",setup(){const e=(0,d.lq)(),a=(0,x.KR)(!1),t=(0,x.KR)({}),l=(0,x.KR)(""),n=(0,x.KR)("district_analysis"),o=(0,x.Kh)({}),r=(0,x.Kh)({district_analysis:null,room_type_analysis:null,direction_analysis:null,floor_analysis:null,price_distribution:null,community_analysis:null}),i=(0,x.KR)(null);(0,s.wB)((()=>e.query),(e=>{e.city&&(l.value=e.city,p())}),{immediate:!0});const c=async()=>{try{t.value=await D.getCities()}catch(e){K.nk.error("获取城市列表失败"),console.error(e)}},u=()=>{p()},k=()=>{setTimeout((()=>{h()}),50)},p=async()=>{try{a.value=!0,await v(),await Promise.all([y("district_analysis"),y("room_type_analysis"),y("direction_analysis"),y("floor_analysis"),y("price_distribution"),y("community_analysis")]),a.value=!1,h()}catch(e){a.value=!1,K.nk.error("获取分析数据失败"),console.error(e)}},v=async()=>{try{const e={};l.value&&(e.city=l.value),i.value=await D.getSummaryStatistics(l.value)}catch(e){console.error("获取概览数据失败",e)}},y=async e=>{try{const a={analysis_type:e,limit:1};l.value&&(a.city=l.value);const t=await D.getAnalysisResults(a);t&&t.length>0?r[e]=JSON.parse(t[0].result_data):r[e]=null}catch(a){console.error(`获取${e}分析结果失败`,a),r[e]=null}},g=()=>{p()},m=()=>i.value&&i.value.district_distribution&&0!==i.value.district_distribution.length?i.value.district_distribution[0].district:"暂无数据",h=()=>{switch(n.value){case"district_analysis":f();break;case"room_type_analysis":b();break;case"direction_analysis":_();break;case"floor_analysis":C();break;case"price_distribution":F();break;case"community_analysis":L();break}},f=()=>{r.district_analysis&&(w({elementId:"district-price-chart",title:"各区域平均租金",data:r.district_analysis,xKey:"location_qu",yKey:"avg_price",type:"bar"}),w({elementId:"district-count-chart",title:"各区域房源数量",data:r.district_analysis,xKey:"location_qu",yKey:"house_count",type:"bar"}))},b=()=>{r.room_type_analysis&&(w({elementId:"room-type-price-chart",title:"各户型平均租金",data:r.room_type_analysis,xKey:"room_type",yKey:"avg_price",type:"bar"}),w({elementId:"room-type-count-chart",title:"各户型房源数量",data:r.room_type_analysis,xKey:"room_type",yKey:"house_count",type:"bar"}))},_=()=>{r.direction_analysis&&w({elementId:"direction-chart",title:"各朝向平均租金",data:r.direction_analysis,xKey:"direction",yKey:"avg_price",type:"bar"})},C=()=>{r.floor_analysis&&w({elementId:"floor-chart",title:"各楼层平均租金",data:r.floor_analysis,xKey:"floor_type",yKey:"avg_price",type:"bar"})},F=()=>{r.price_distribution&&w({elementId:"price-distribution-chart",title:"租金价格分布",data:r.price_distribution,xKey:"price_range",yKey:"house_count",type:"bar"})},L=()=>{if(!r.community_analysis)return;const e=r.community_analysis.slice(0,15);w({elementId:"community-chart",title:"热门小区平均租金",data:e,xKey:"location_small",yKey:"avg_price",type:"bar"})},w=({elementId:e,title:a,data:t,xKey:l,yKey:s,type:n="bar"})=>{const r=document.getElementById(e);if(!r)return;o[e]&&o[e].dispose(),o[e]=xe.Ts(r);const i=t.map((e=>e[l])),c=t.map((e=>e[s])),u={title:{text:a,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:i,axisLabel:{interval:0,rotate:30}},yAxis:{type:"value"},series:[{name:"avg_price"===s?"平均租金":"房源数量",type:n,data:c}]};o[e].setOption(u),window.addEventListener("resize",(()=>{o[e].resize()}))};return(0,s.sV)((()=>{c(),e.query.city&&(l.value=e.query.city),p()})),{loading:a,cities:t,selectedCity:l,activeTab:n,analysisData:r,summaryData:i,handleCityChange:u,handleTabClick:k,refreshData:g,getTopDistrict:m}}};const Se=(0,v.A)(Ke,[["render",We],["__scopeId","data-v-22d67654"]]);var Ie=Se,Te={name:"AnalysisView",components:{AnalysisResults:Ie}};const Xe=(0,v.A)(Te,[["render",ye],["__scopeId","data-v-7a984902"]]);var De=Xe;const Re={class:"not-found"};function Ee(e,a,t,l,n,o){const r=(0,s.g2)("el-button"),i=(0,s.g2)("el-result");return(0,s.uX)(),(0,s.CE)("div",Re,[(0,s.bF)(i,{icon:"warning",title:"404","sub-title":"抱歉，您访问的页面不存在"},{extra:(0,s.k6)((()=>[(0,s.bF)(r,{type:"primary",onClick:l.goHome},{default:(0,s.k6)((()=>a[0]||(a[0]=[(0,s.eW)("返回首页")]))),_:1},8,["onClick"])])),_:1})])}var Me={name:"NotFound",setup(){const e=(0,d.rd)(),a=()=>{e.push({name:"home"})};return{goHome:a}}};const $e=(0,v.A)(Me,[["render",Ee],["__scopeId","data-v-4d9e9efc"]]);var Pe=$e;const Ae={class:"captcha-list"},Ve={class:"header"},ze={class:"action-bar"},qe={class:"card-header"},Oe={style:{"margin-left":"10px"}},Be={class:"url-text"};function Ue(e,a,t,o,r,i){const c=(0,s.g2)("el-col"),u=(0,s.g2)("el-row"),d=(0,s.g2)("el-header"),k=(0,s.g2)("el-button"),p=(0,s.g2)("el-tag"),v=(0,s.g2)("el-card"),y=(0,s.g2)("el-empty"),g=(0,s.g2)("el-main"),m=(0,s.g2)("el-footer"),h=(0,s.g2)("el-container");return(0,s.uX)(),(0,s.CE)("div",Ae,[(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",Ve,[(0,s.bF)(u,null,{default:(0,s.k6)((()=>[(0,s.bF)(c,{span:24},{default:(0,s.k6)((()=>a[0]||(a[0]=[(0,s.Lk)("h1",null,"贝壳网验证码代理系统",-1),(0,s.Lk)("p",null,"远程处理爬虫遇到的人机验证",-1)]))),_:1})])),_:1})])])),_:1}),(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",ze,[a[2]||(a[2]=(0,s.Lk)("h2",null,"活跃会话列表",-1)),(0,s.bF)(k,{type:"primary",onClick:o.refreshSessions,icon:o.RefreshRight},{default:(0,s.k6)((()=>a[1]||(a[1]=[(0,s.eW)("刷新列表")]))),_:1},8,["onClick","icon"])]),(0,s.bF)(u,{gutter:20},{default:(0,s.k6)((()=>[o.sessions.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(o.sessions,(e=>((0,s.uX)(),(0,s.Wv)(c,{key:e.id,xs:24,sm:12,md:8,lg:6},{default:(0,s.k6)((()=>[(0,s.bF)(v,{class:"session-card",onClick:a=>o.openControlPage(e.id)},{header:(0,s.k6)((()=>[(0,s.Lk)("div",qe,["active"===e.status?((0,s.uX)(),(0,s.Wv)(p,{key:0,type:"success"},{default:(0,s.k6)((()=>a[3]||(a[3]=[(0,s.eW)("活跃")]))),_:1})):"completed"===e.status?((0,s.uX)(),(0,s.Wv)(p,{key:1,type:"info"},{default:(0,s.k6)((()=>a[4]||(a[4]=[(0,s.eW)("已完成")]))),_:1})):"closed"===e.status?((0,s.uX)(),(0,s.Wv)(p,{key:2,type:"danger"},{default:(0,s.k6)((()=>a[5]||(a[5]=[(0,s.eW)("已关闭")]))),_:1})):((0,s.uX)(),(0,s.Wv)(p,{key:3,type:"warning"},{default:(0,s.k6)((()=>a[6]||(a[6]=[(0,s.eW)("未知")]))),_:1})),(0,s.Lk)("span",Oe,"会话: "+(0,n.v_)(e.id),1)])])),default:(0,s.k6)((()=>[(0,s.Lk)("div",null,[(0,s.Lk)("p",null,[a[7]||(a[7]=(0,s.Lk)("strong",null,"任务ID:",-1)),(0,s.eW)(" "+(0,n.v_)(e.task_id),1)]),(0,s.Lk)("p",null,[a[8]||(a[8]=(0,s.Lk)("strong",null,"城市代码:",-1)),(0,s.eW)(" "+(0,n.v_)(e.city_code),1)]),(0,s.Lk)("p",null,[a[9]||(a[9]=(0,s.Lk)("strong",null,"创建时间:",-1)),(0,s.eW)(" "+(0,n.v_)(o.formatDateTime(e.created_at)),1)]),(0,s.Lk)("p",null,[a[10]||(a[10]=(0,s.Lk)("strong",null,"最后更新:",-1)),(0,s.eW)(" "+(0,n.v_)(o.formatDateTime(e.last_update)),1)]),(0,s.Lk)("p",Be,[a[11]||(a[11]=(0,s.Lk)("strong",null,"URL:",-1)),(0,s.eW)(" "+(0,n.v_)(o.truncateText(e.url,30)),1)]),(0,s.bF)(k,{type:"primary",onClick:(0,l.D$)((a=>o.openControlPage(e.id)),["stop"])},{default:(0,s.k6)((()=>a[12]||(a[12]=[(0,s.eW)("管理会话")]))),_:2},1032,["onClick"])])])),_:2},1032,["onClick"])])),_:2},1024)))),128)):((0,s.uX)(),(0,s.Wv)(c,{key:1,span:24},{default:(0,s.k6)((()=>[(0,s.bF)(y,{description:"暂无活跃会话","image-size":200},{description:(0,s.k6)((()=>a[13]||(a[13]=[(0,s.Lk)("p",null,[(0,s.eW)("当爬虫遇到验证码时，会自动创建验证会话"),(0,s.Lk)("br"),(0,s.eW)("目前没有需要处理的验证")],-1)]))),_:1})])),_:1}))])),_:1})])),_:1}),(0,s.bF)(m,null,{default:(0,s.k6)((()=>a[14]||(a[14]=[(0,s.Lk)("div",{style:{"text-align":"center","margin-top":"20px",padding:"20px","border-top":"1px solid #eee"}},[(0,s.Lk)("p",null,"贝壳网验证码代理系统 © 2025")],-1)]))),_:1})])),_:1})])}var Qe={name:"CaptchaList",setup(){const e=(0,d.rd)(),a=(0,x.KR)([]),t=(0,x.KR)(!1);let l=null;const n=e=>{if(!e||"未知"===e)return"未知";try{const a=new Date(e);return a.toLocaleString()}catch(a){return e}},o=(e,a)=>e?e.length>a?e.substring(0,a)+"...":e:"",r=async()=>{t.value=!0;try{const e=await T.A.get("/captcha/api/sessions");a.value=e.data.sessions||[]}catch(e){console.error("获取会话列表失败:",e),console.log("请检查API路径是否正确，当前使用: /captcha/api/sessions")}finally{t.value=!1}},i=()=>{r()},c=a=>{e.push(`/captcha/control/${a}`)};return(0,s.sV)((()=>{r(),l=setInterval(r,3e4)})),(0,s.xo)((()=>{l&&clearInterval(l)})),{sessions:a,loading:t,formatDateTime:n,truncateText:o,refreshSessions:i,openControlPage:c,RefreshRight:k.RefreshRight}}};const He=(0,v.A)(Qe,[["render",Ue],["__scopeId","data-v-08a47126"]]);var je=He;const Ne={class:"captcha-control"},Ye={class:"header"},Je={key:0,class:"instruction-box"},Ze={class:"session-info"},Ge={class:"browser-container",ref:"browserContainer"},ea={key:0,class:"loading-overlay"},aa={key:2,class:"no-screenshot"},ta=["src"],la={key:2,class:"ai-suggestion"},sa={class:"action-bar"},na={key:3,class:"shortcuts-panel"},oa={key:4,class:"debug-info"},ra={class:"operation-log"},ia={key:0,class:"log-entry log-info"},ca={key:5,class:"drag-mode-indicator"},ua={key:0},da={key:1};function ka(e,a,t,o,r,i){const c=(0,s.g2)("el-button"),u=(0,s.g2)("el-header"),d=(0,s.g2)("el-alert"),k=(0,s.g2)("el-descriptions-item"),p=(0,s.g2)("el-tag"),v=(0,s.g2)("el-descriptions"),y=(0,s.g2)("Pointer"),g=(0,s.g2)("el-icon"),m=(0,s.g2)("DArrowRight"),h=(0,s.g2)("ZoomIn"),f=(0,s.g2)("InfoFilled"),b=(0,s.g2)("el-main"),_=(0,s.g2)("el-footer"),C=(0,s.g2)("el-container");return(0,s.uX)(),(0,s.CE)("div",Ne,[(0,s.bF)(C,null,{default:(0,s.k6)((()=>[(0,s.bF)(u,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",Ye,[a[10]||(a[10]=(0,s.Lk)("h1",null,"验证会话控制页",-1)),(0,s.bF)(c,{type:"primary",onClick:o.backToList},{default:(0,s.k6)((()=>a[9]||(a[9]=[(0,s.eW)("返回列表")]))),_:1},8,["onClick"])])])),_:1}),(0,s.bF)(b,null,{default:(0,s.k6)((()=>[o.sessionCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Je,a[11]||(a[11]=[(0,s.Lk)("h3",null,"操作指南",-1),(0,s.Lk)("p",null,"1. 在下方浏览器窗口中完成贝壳网的人机验证",-1),(0,s.Lk)("p",null,"2. 点击屏幕上的元素进行操作，可以直接通过点击进行滑块验证",-1),(0,s.Lk)("p",null,'3. 验证完成后点击"完成验证"按钮通知爬虫程序继续运行',-1),(0,s.Lk)("p",null,'4. 如需刷新页面可以点击"刷新页面"按钮',-1)]))),o.sessionCompleted?((0,s.uX)(),(0,s.Wv)(d,{key:1,title:"验证已完成",type:"success",description:"此验证会话已标记为完成，爬虫程序已继续运行",closable:!1,"show-icon":""})):(0,s.Q3)("",!0),(0,s.Lk)("div",Ze,[(0,s.bF)(v,{title:"会话信息",column:3,border:""},{default:(0,s.k6)((()=>[(0,s.bF)(k,{label:"会话ID"},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(o.sessionId),1)])),_:1}),(0,s.bF)(k,{label:"状态"},{default:(0,s.k6)((()=>["active"===o.sessionStatus?((0,s.uX)(),(0,s.Wv)(p,{key:0,type:"success"},{default:(0,s.k6)((()=>a[12]||(a[12]=[(0,s.eW)("活跃")]))),_:1})):"completed"===o.sessionStatus?((0,s.uX)(),(0,s.Wv)(p,{key:1,type:"info"},{default:(0,s.k6)((()=>a[13]||(a[13]=[(0,s.eW)("已完成")]))),_:1})):"closed"===o.sessionStatus?((0,s.uX)(),(0,s.Wv)(p,{key:2,type:"danger"},{default:(0,s.k6)((()=>a[14]||(a[14]=[(0,s.eW)("已关闭")]))),_:1})):((0,s.uX)(),(0,s.Wv)(p,{key:3,type:"warning"},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(o.sessionStatus),1)])),_:1}))])),_:1}),(0,s.bF)(k,{label:"创建时间"},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(o.formatTime(o.sessionCreatedAt)),1)])),_:1})])),_:1})]),(0,s.Lk)("div",Ge,[o.loading?((0,s.uX)(),(0,s.CE)("div",ea,a[15]||(a[15]=[(0,s.Lk)("div",{class:"el-loading-spinner"},[(0,s.Lk)("svg",{class:"circular",viewBox:"25 25 50 50"},[(0,s.Lk)("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none"})]),(0,s.Lk)("p",{class:"el-loading-text"},"加载中...")],-1)]))):(0,s.Q3)("",!0),o.showClickIndicator?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"click-indicator",style:(0,n.Tr)(o.indicatorStyle)},null,4)):(0,s.Q3)("",!0),o.screenshot?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",aa,a[16]||(a[16]=[(0,s.Lk)("span",null,'加载截图中...如长时间无截图显示，请尝试点击"刷新页面"按钮',-1)]))),o.screenshot?((0,s.uX)(),(0,s.CE)("img",{key:3,src:o.screenshot,alt:"浏览器截图",class:"browser-screen"},null,8,ta)):(0,s.Q3)("",!0),o.sessionCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",{key:4,class:"browser-overlay",onClick:a[0]||(a[0]=(...e)=>o.handleScreenClick&&o.handleScreenClick(...e)),onMousemove:a[1]||(a[1]=(...e)=>o.handleMouseMove&&o.handleMouseMove(...e)),onMousedown:a[2]||(a[2]=(...e)=>o.handleMouseDown&&o.handleMouseDown(...e)),onMouseup:a[3]||(a[3]=(...e)=>o.handleMouseUp&&o.handleMouseUp(...e)),ref:"browserOverlay"},null,544)),o.screenshot?(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",{key:5,class:"floating-toolbar",style:(0,n.Tr)({top:o.toolbarPosition.y+"px",left:o.toolbarPosition.x+"px"})},[(0,s.Lk)("div",{class:(0,n.C4)(["toolbar-button",{active:"click"===o.interactionMode}]),title:"点击模式",onClick:a[4]||(a[4]=e=>o.setInteractionMode("click"))},[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(y)])),_:1})],2),(0,s.Lk)("div",{class:(0,n.C4)(["toolbar-button",{active:"drag"===o.interactionMode}]),title:"拖动模式",onClick:a[5]||(a[5]=e=>o.setInteractionMode("drag"))},[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(m)])),_:1})],2),(0,s.Lk)("div",{class:"toolbar-button",title:"放大查看",onClick:a[6]||(a[6]=(...e)=>o.zoomIn&&o.zoomIn(...e))},[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(h)])),_:1})])],4)),[[l.aG,o.isToolbarVisible]]):(0,s.Q3)("",!0)],512),o.aiSuggestion?((0,s.uX)(),(0,s.CE)("div",la,[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(f)])),_:1}),a[17]||(a[17]=(0,s.eW)()),a[18]||(a[18]=(0,s.Lk)("strong",null,"智能提示:",-1)),(0,s.eW)(" "+(0,n.v_)(o.aiSuggestion),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",sa,[(0,s.bF)(c,{type:"primary",disabled:o.sessionCompleted||o.loading,onClick:o.completeVerification},{default:(0,s.k6)((()=>a[19]||(a[19]=[(0,s.eW)(" 完成验证 ")]))),_:1},8,["disabled","onClick"]),(0,s.bF)(c,{type:"success",disabled:o.sessionCompleted||o.loading,onClick:o.initDragMode},{default:(0,s.k6)((()=>a[20]||(a[20]=[(0,s.eW)(" 滑块拖动模式 ")]))),_:1},8,["disabled","onClick"]),(0,s.bF)(c,{type:"info",disabled:o.sessionCompleted||o.loading,onClick:o.refreshBrowser},{default:(0,s.k6)((()=>a[21]||(a[21]=[(0,s.eW)(" 刷新页面 ")]))),_:1},8,["disabled","onClick"]),(0,s.bF)(c,{type:"danger",disabled:o.sessionCompleted||o.loading,onClick:o.closeSession},{default:(0,s.k6)((()=>a[22]||(a[22]=[(0,s.eW)(" 关闭会话 ")]))),_:1},8,["disabled","onClick"])]),o.showShortcuts?((0,s.uX)(),(0,s.CE)("div",na,[(0,s.Lk)("h4",null,[a[24]||(a[24]=(0,s.eW)("键盘快捷键 ")),(0,s.bF)(c,{type:"text",size:"small",onClick:a[7]||(a[7]=e=>o.showShortcuts=!1)},{default:(0,s.k6)((()=>a[23]||(a[23]=[(0,s.eW)("关闭")]))),_:1})]),a[25]||(a[25]=(0,s.Lk)("div",null,[(0,s.Lk)("span",{class:"shortcut-key"},"R"),(0,s.eW)(" 刷新页面")],-1)),a[26]||(a[26]=(0,s.Lk)("div",null,[(0,s.Lk)("span",{class:"shortcut-key"},"D"),(0,s.eW)(" 滑块拖动模式")],-1)),a[27]||(a[27]=(0,s.Lk)("div",null,[(0,s.Lk)("span",{class:"shortcut-key"},"C"),(0,s.eW)(" 完成验证")],-1)),a[28]||(a[28]=(0,s.Lk)("div",null,[(0,s.Lk)("span",{class:"shortcut-key"},"Esc"),(0,s.eW)(" 取消当前模式")],-1)),a[29]||(a[29]=(0,s.Lk)("div",null,[(0,s.Lk)("span",{class:"shortcut-key"},"F1"),(0,s.eW)(" 显示/隐藏快捷键")],-1)),a[30]||(a[30]=(0,s.Lk)("div",null,[(0,s.Lk)("span",{class:"shortcut-key"},"F2"),(0,s.eW)(" 显示/隐藏调试信息")],-1))])):(0,s.Q3)("",!0),o.showDebug?((0,s.uX)(),(0,s.CE)("div",oa,[(0,s.Lk)("p",null,"WebSocket状态: "+(0,n.v_)(o.wsStatus),1),(0,s.Lk)("p",null,"最后接收消息: "+(0,n.v_)(o.lastMessage),1),(0,s.Lk)("p",null,"截图更新时间: "+(0,n.v_)(o.lastUpdateTime),1),(0,s.bF)(c,{size:"small",onClick:o.reconnectWebSocket},{default:(0,s.k6)((()=>a[31]||(a[31]=[(0,s.eW)("重新连接WebSocket")]))),_:1},8,["onClick"]),(0,s.bF)(c,{size:"small",onClick:a[8]||(a[8]=e=>o.showDebug=!1)},{default:(0,s.k6)((()=>a[32]||(a[32]=[(0,s.eW)("隐藏调试信息")]))),_:1})])):(0,s.Q3)("",!0),(0,s.Lk)("div",ra,[(0,s.Lk)("h3",null,[a[34]||(a[34]=(0,s.eW)("操作日志 ")),(0,s.bF)(c,{type:"text",onClick:o.clearLogs},{default:(0,s.k6)((()=>a[33]||(a[33]=[(0,s.eW)("清空")]))),_:1},8,["onClick"])]),0===o.operationLogs.length?((0,s.uX)(),(0,s.CE)("div",ia," 尚无操作日志，点击截图或按钮执行操作。 ")):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.operationLogs,((e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,n.C4)(["log-entry","log-"+e.type])},[(0,s.Lk)("span",null,(0,n.v_)(e.time)+" - "+(0,n.v_)(e.message),1)],2)))),128))]),o.isDragMode?((0,s.uX)(),(0,s.CE)("div",ca,[!0===o.isDragMode?((0,s.uX)(),(0,s.CE)("p",ua,a[35]||(a[35]=[(0,s.Lk)("strong",null,"滑块拖动模式:",-1),(0,s.eW)(" 请点击滑块位置 ")]))):"endpoint"===o.isDragMode?((0,s.uX)(),(0,s.CE)("p",da,a[36]||(a[36]=[(0,s.Lk)("strong",null,"滑块拖动模式:",-1),(0,s.eW)(" 请点击目标位置 ")]))):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(_,null,{default:(0,s.k6)((()=>a[37]||(a[37]=[(0,s.Lk)("div",{style:{"text-align":"center","margin-top":"20px",padding:"20px","border-top":"1px solid #eee"}},[(0,s.Lk)("p",null,"贝壳网验证码代理系统 © 2025")],-1)]))),_:1})])),_:1})])}var pa={name:"CaptchaControl",components:{Pointer:k.Pointer,DArrowRight:k.DArrowRight,ZoomIn:k.ZoomIn,InfoFilled:k.InfoFilled},setup(){const e=(0,d.rd)(),a=(0,d.lq)(),t=(0,x.KR)(a.params.sessionId),l=(0,x.KR)(""),n=(0,x.KR)(""),o=(0,x.KR)(!1),r=(0,x.KR)(""),i=(0,x.KR)(!0),c=(0,x.KR)(null),u=(0,x.KR)(null),k=(0,x.KR)(null),p=(0,x.KR)(!1),v=(0,x.Kh)({x:0,y:0}),y=(0,x.Kh)({x:0,y:0}),g=(0,x.KR)("click"),m=(0,x.KR)(!0),h=(0,x.Kh)({x:10,y:10}),f=(0,x.Kh)({x:0,y:0}),b=(0,x.KR)(!1),_=(0,x.KR)(""),C=(0,x.KR)("未连接"),F=(0,x.KR)("无"),L=(0,x.KR)("无"),w=(0,x.KR)(!1),W=(0,x.KR)(!0),S=(0,x.KR)([]),I=20,X=(0,x.KR)(!1),D=(0,x.Kh)({x:0,y:0}),R=(0,s.EW)((()=>({left:`${D.x}px`,top:`${D.y}px`}))),E=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch(a){return e}},M=()=>{c.value&&c.value.readyState!==WebSocket.CLOSED&&c.value.close(),C.value="连接中...",V("正在连接WebSocket...","info");const e="https:"===window.location.protocol?"wss:":"ws:",a=`${e}//${window.location.host}/captcha/ws/${t.value}`;V(`WebSocket连接URL: ${a}`,"info");try{const e=new WebSocket(a);e.onopen=()=>{V("WebSocket连接已建立","success"),C.value="已连接",e.send("get_screenshot")},e.onmessage=e=>{try{const a=JSON.parse(e.data);F.value=JSON.stringify(a).substring(0,50)+"...","screenshot_update"===a.type&&a.screenshot?(r.value=`data:image/png;base64,${a.screenshot}`,i.value=!1,L.value=(new Date).toLocaleTimeString(),V("收到新的截图","info")):"status_update"===a.type?(l.value=a.status,V(`收到状态更新: ${a.status}`,"info"),"completed"===a.status&&(o.value=!0,K.nk.success("验证已完成"))):"error"===a.type&&(V(`收到错误消息: ${a.message}`,"error"),K.nk.error(a.message))}catch(a){V(`解析WebSocket消息失败: ${a.message}`,"error")}},e.onerror=e=>{V(`WebSocket错误: ${e}`,"error"),C.value="连接错误"},e.onclose=()=>{V("WebSocket连接已关闭","warning"),C.value="已关闭",o.value||setTimeout(M,3e3)},c.value=e}catch(s){V(`创建WebSocket连接失败: ${s.message}`,"error"),C.value="创建连接失败"}},$=()=>{C.value="正在重连...",M()},P=async()=>{try{const e=await T.A.get(`/captcha/api/check_verification/${t.value}`);console.log("会话信息:",e.data);const{verified:a,status:s}=e.data;l.value=s||(a?"completed":"active"),o.value=a,a&&c.value&&c.value.close()}catch(e){console.error("获取会话信息失败:",e)}},A=async()=>{try{V("等待通过WebSocket接收截图...","info"),c.value&&c.value.readyState===WebSocket.OPEN?c.value.send("get_screenshot"):M();const e=setTimeout((()=>{i.value&&V("截图加载超时，请刷新页面或重新连接WebSocket","warning")}),5e3);return()=>clearTimeout(e)}catch(e){console.error("加载截图失败:",e),V('截图加载失败，请点击"刷新页面"按钮',"error")}},V=(e,a="info")=>{const t=(new Date).toLocaleTimeString();S.value.unshift({time:t,message:e,type:a}),S.value.length>I&&(S.value=S.value.slice(0,I)),"error"===a&&j("遇到错误，您可以尝试刷新页面或切换操作模式")},z=()=>{S.value=[]},q=async e=>{if(i.value||o.value)return;const a=k.value.getBoundingClientRect(),l=e.clientX-a.left,s=e.clientY-a.top;if(!0===p.value)return v.x=l,v.y=s,V(`已选择滑块起点: (${Math.round(l)}, ${Math.round(s)})`,"info"),K.nk.info("已选择起点，请再次点击设置终点"),void(p.value="endpoint");if("endpoint"===p.value)return y.x=l,y.y=s,V(`已选择目标点: (${Math.round(l)}, ${Math.round(s)})`,"info"),await N(),void(p.value=!1);D.x=l,D.y=s,X.value=!0,setTimeout((()=>{X.value=!1}),500),i.value=!0,V(`执行点击: (${Math.round(l)}, ${Math.round(s)})`,"info");try{console.log("执行点击操作:",l,s);const e=await T.A.post(`/captcha/api/session/${t.value}/action`,{action_type:"click",x:Math.round(l),y:Math.round(s)});e.data.success?V("点击成功: "+(e.data.details?.method?"方法"+e.data.details.method:""),"success"):V(`点击失败: ${e.data.details?.error||"未知错误"}`,"error")}catch(n){console.error("执行点击操作失败:",n),V(`点击异常: ${n.message||"未知错误"}`,"error")}finally{i.value=!1}},O=e=>{if(i.value||o.value)return;const a=k.value.getBoundingClientRect();f.x=e.clientX-a.left,f.y=e.clientY-a.top,b.value&&g.value},B=e=>{if(i.value||o.value)return;b.value=!0;const a=k.value.getBoundingClientRect(),t=e.clientX-a.left,l=e.clientY-a.top;"drag"===g.value&&(v.x=t,v.y=l,V(`开始拖动，起点: (${Math.round(t)}, ${Math.round(l)})`,"info"))},U=async e=>{if(i.value||o.value)return;if(!b.value)return;b.value=!1;const a=k.value.getBoundingClientRect(),t=e.clientX-a.left,l=e.clientY-a.top;if("drag"===g.value){const e=t-v.x,a=l-v.y;(Math.abs(e)>10||Math.abs(a)>10)&&(y.x=t,y.y=l,V(`结束拖动，终点: (${Math.round(t)}, ${Math.round(l)})`,"info"),await N())}},Q=e=>{g.value=e,p.value="drag"===e,"drag"===e?(V("已切换到拖动模式：按住鼠标拖动滑块","info"),j("请在滑块上按下鼠标并拖动到目标位置")):(V("已切换到点击模式","info"),j("点击模式已激活，点击验证码中需要选择的元素"))},H=()=>{V("放大功能暂未实现","info"),j("您可以使用浏览器自带的缩放功能进行放大 (Ctrl + +)")},j=e=>{_.value=e,setTimeout((()=>{_.value===e&&(_.value="")}),5e3)},N=async()=>{i.value=!0,V(`执行拖动: 从(${Math.round(v.x)}, ${Math.round(v.y)})到(${Math.round(y.x)}, ${Math.round(y.y)})`,"info");try{console.log(`执行拖动操作: 从(${v.x}, ${v.y})到(${y.x}, ${y.y})`);const e=await T.A.post(`/captcha/api/session/${t.value}/action`,{action_type:"drag",x:Math.round(v.x),y:Math.round(v.y),target_x:Math.round(y.x)});e.data.success?(V("拖动成功: "+(e.data.details?.method?"方法"+e.data.details.method:""),"success"),K.nk.success("拖动操作已执行")):(V(`拖动失败: ${e.data.details?.error||"未知错误"}`,"error"),K.nk.error("拖动操作失败"))}catch(e){console.error("执行拖动操作失败:",e),V(`拖动异常: ${e.message||"未知错误"}`,"error"),K.nk.error("拖动操作失败")}finally{i.value=!1}},Y=()=>{p.value=!0,V("进入滑块拖动模式，请先点击滑块位置","info"),j("请先点击滑块的起始位置，然后再点击需要拖动到的目标位置")},J=async()=>{if(!i.value&&!o.value){i.value=!0,V("刷新页面","info");try{const e=await T.A.post(`/captcha/api/session/${t.value}/action`,{action_type:"refresh"});e.data.success?V("页面刷新成功","success"):V(`页面刷新失败: ${e.data.details?.error||"未知错误"}`,"error"),console.log("页面已刷新")}catch(e){console.error("刷新页面失败:",e),V(`刷新页面异常: ${e.message||"未知错误"}`,"error")}finally{i.value=!1}}},Z=async()=>{if(!i.value&&!o.value){i.value=!0,V("标记验证完成","info");try{const e=await T.A.post(`/captcha/api/session/${t.value}/action`,{action_type:"complete"});o.value=!0,l.value="completed",e.data.success&&V("验证已标记为完成","success"),console.log("验证已完成"),c.value&&c.value.close()}catch(e){console.error("完成验证失败:",e),V(`标记验证完成异常: ${e.message||"未知错误"}`,"error")}finally{i.value=!1}}},G=async()=>{if(!i.value){i.value=!0;try{await T.A.post(`/captcha/api/session/${t.value}/action`,{action_type:"close"}),l.value="closed",console.log("会话已关闭"),c.value&&c.value.close(),setTimeout((()=>{e.push("/captcha")}),1500)}catch(a){console.error("关闭会话失败:",a)}finally{i.value=!1}}},ee=()=>{e.push("/captcha")};return(0,s.sV)((()=>{console.log("组件已挂载"),V("页面已加载，正在获取验证会话信息","info"),P(),M(),A(),setTimeout((()=>{r.value&&t()}),2e3);const e=setInterval(P,1e4),a=e=>{if(!i.value&&!o.value){if("Escape"===e.key)return p.value&&(p.value=!1,g.value="click",V("已取消拖动模式","info")),void(_.value="");if("F1"!==e.key)if("F2"!==e.key&&"d"!==e.key&&"D"!==e.key)switch(e.key.toLowerCase()){case"r":J();break;case"d":Y();break;case"c":Z();break;case"t":m.value=!m.value;break}else w.value=!w.value;else W.value=!W.value}};window.addEventListener("keydown",a);const t=()=>{j("系统已准备就绪，请操作验证码。如需帮助请按F1查看快捷键")};(0,s.xo)((()=>{clearInterval(e),c.value&&c.value.close(),window.removeEventListener("keydown",a)}))})),{sessionId:t,sessionStatus:l,sessionCreatedAt:n,sessionCompleted:o,screenshot:r,loading:i,showClickIndicator:X,indicatorStyle:R,wsStatus:C,lastMessage:F,lastUpdateTime:L,isDragMode:p,showDebug:w,operationLogs:S,interactionMode:g,isToolbarVisible:m,toolbarPosition:h,showShortcuts:W,aiSuggestion:_,formatTime:E,handleScreenClick:q,refreshBrowser:J,completeVerification:Z,closeSession:G,backToList:ee,reconnectWebSocket:$,initDragMode:Y,clearLogs:z,handleMouseMove:O,handleMouseDown:B,handleMouseUp:U,setInteractionMode:Q,zoomIn:H,browserContainer:u,browserOverlay:k}}};const va=(0,v.A)(pa,[["render",ka],["__scopeId","data-v-9a152f26"]]);var ya=va;const ga={class:"verify-container"},ma={class:"container"},ha={class:"buttons"};function fa(e,a,t,l,o,r){const i=(0,s.g2)("el-button");return(0,s.uX)(),(0,s.CE)("div",ga,[(0,s.Lk)("div",ma,[a[1]||(a[1]=(0,s.Fv)('<h1 data-v-0244a6a1>贝壳网验证控制中心</h1><div class="selenium-instructions" data-v-0244a6a1><h3 data-v-0244a6a1>重要：请首先在Chrome窗口中完成验证！</h3><p data-v-0244a6a1>请先在爬虫打开的Chrome窗口中<span class="highlight" data-v-0244a6a1>完成全部验证步骤</span>，直到页面显示正常网页内容。</p><p data-v-0244a6a1><span class="highlight" data-v-0244a6a1>不要关闭或刷新</span>该Chrome浏览器窗口，让它自然完成验证流程。</p></div><div class="warning-box" data-v-0244a6a1><h4 data-v-0244a6a1>贝壳网验证流程说明:</h4><p data-v-0244a6a1>1. 贝壳网的验证可能需要多个步骤（滑块、图片选择等）</p><p data-v-0244a6a1>2. 必须在Chrome窗口中<span class="highlight" data-v-0244a6a1>全部完成这些步骤</span>后才能继续</p><p data-v-0244a6a1>3. 如果仅点击了验证开始按钮但没完成后续步骤，验证会失败</p></div><div class="instructions" data-v-0244a6a1><h3 data-v-0244a6a1>正确的验证步骤：</h3><ol data-v-0244a6a1><li data-v-0244a6a1>在Chrome窗口中<span class="highlight" data-v-0244a6a1>完全完成</span>验证流程，直到看到正常网页内容</li><li data-v-0244a6a1>验证完全完成后，回到当前页面</li><li data-v-0244a6a1>点击下方的&quot;<strong data-v-0244a6a1>已完成验证</strong>&quot;按钮</li><li data-v-0244a6a1>系统会检查验证状态并继续爬取</li></ol></div>',4)),(0,s.Lk)("div",ha,[(0,s.bF)(i,{type:"primary",size:"large",class:"confirm-btn",disabled:l.btnDisabled,onClick:l.confirmVerification},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(l.confirmButtonText),1)])),_:1},8,["disabled","onClick"]),(0,s.bF)(i,{class:"cancel-btn",type:"danger",size:"large",onClick:l.cancelVerification},{default:(0,s.k6)((()=>a[0]||(a[0]=[(0,s.eW)(" 取消验证 ")]))),_:1},8,["onClick"])]),l.statusMessage?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,n.C4)(["status",l.statusClass])},(0,n.v_)(l.statusMessage),3)):(0,s.Q3)("",!0)])])}var ba=t(7918),_a={name:"CaptchaVerify",setup(){const e=(0,d.lq)(),a=(0,x.KR)(e.params.sessionId),t=(0,x.KR)(""),l=(0,x.KR)(""),n=(0,x.KR)(""),o=(0,x.KR)(!1),r=(0,x.KR)("已完成验证");let i=null;const c=async()=>{try{const e=await T.A.get(`/api/verification/${a.value}/status`),t=e.data;"completed"===t.status?(p("验证已完成，爬虫任务正在继续...","success"),clearInterval(i),o.value=!0,r.value="验证已完成"):"failed"===t.status&&(p(`验证失败: ${t.error_message||"未知错误"}`,"error"),clearInterval(i))}catch(e){console.error("获取验证状态失败:",e)}},u=async()=>{o.value=!0,r.value="正在提交...",p("正在提交验证结果...","loading");try{const e=await T.A.post(`/api/verification/${a.value}/complete`),t=e.data;t.success?(p("验证已成功提交！爬虫将自动继续任务","success"),r.value="验证已提交"):(p(`验证提交失败: ${t.message||"未知错误"}`,"error"),o.value=!1,r.value="再次提交验证")}catch(e){p("验证提交时发生错误，请稍后重试","error"),console.error("验证提交错误:",e),o.value=!1,r.value="再次提交验证"}},k=async()=>{try{const t=await ba.s.confirm("确定要取消验证吗？这将中断当前的爬虫任务。","确认取消",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});if("confirm"===t)try{const e=await T.A.post(`/api/verification/${a.value}/cancel`),t=e.data;t.success?(p("验证已取消","error"),clearInterval(i),o.value=!0):p("取消验证失败","error")}catch(e){console.error("取消验证错误:",e),p("取消验证时发生错误","error")}}catch{}},p=(e,a)=>{l.value=e,n.value=a};return(0,s.sV)((()=>{i=setInterval(c,1e4),c()})),(0,s.xo)((()=>{i&&clearInterval(i)})),{sessionId:a,pageUrl:t,statusMessage:l,statusClass:n,btnDisabled:o,confirmButtonText:r,confirmVerification:u,cancelVerification:k}}};const Ca=(0,v.A)(_a,[["render",fa],["__scopeId","data-v-0244a6a1"]]);var Fa=Ca;const La=[{path:"/",name:"home",component:A,meta:{title:"首页 - 租房数据分析系统"}},{path:"/tasks",name:"taskList",component:J,meta:{title:"爬虫任务列表 - 租房数据分析系统"}},{path:"/houses",name:"houseList",component:pe,meta:{title:"房源列表 - 租房数据分析系统"}},{path:"/analysis",name:"analysis",component:De,meta:{title:"数据分析 - 租房数据分析系统"}},{path:"/captcha",name:"captchaList",component:je,meta:{title:"验证码会话列表 - 租房数据分析系统"}},{path:"/captcha/control/:sessionId",name:"captchaControl",component:ya,meta:{title:"验证码控制 - 租房数据分析系统"}},{path:"/captcha/verify/:sessionId",name:"captchaVerify",component:Fa,meta:{title:"验证码验证 - 租房数据分析系统"}},{path:"/:pathMatch(.*)*",name:"notFound",component:Pe,meta:{title:"404 Not Found - 租房数据分析系统"}}],wa=(0,d.aE)({history:(0,d.LA)(),routes:La});wa.beforeEach(((e,a,t)=>{document.title=e.meta.title||"租房数据分析系统",t()}));var Wa=wa,xa=t(1638),Ka=(t(4188),t(7487));const Sa=(0,l.Ef)(g);for(const[Ia,Ta]of Object.entries(k))Sa.component(Ia,Ta);Sa.use(Wa),Sa.use(xa.A,{locale:Ka.A}),Sa.mount("#app")}},a={};function t(l){var s=a[l];if(void 0!==s)return s.exports;var n=a[l]={exports:{}};return e[l].call(n.exports,n,n.exports,t),n.exports}t.m=e,function(){var e=[];t.O=function(a,l,s,n){if(!l){var o=1/0;for(u=0;u<e.length;u++){l=e[u][0],s=e[u][1],n=e[u][2];for(var r=!0,i=0;i<l.length;i++)(!1&n||o>=n)&&Object.keys(t.O).every((function(e){return t.O[e](l[i])}))?l.splice(i--,1):(r=!1,n<o&&(o=n));if(r){e.splice(u--,1);var c=s();void 0!==c&&(a=c)}}return a}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[l,s,n]}}(),function(){t.d=function(e,a){for(var l in a)t.o(a,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:a[l]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};t.O.j=function(a){return 0===e[a]};var a=function(a,l){var s,n,o=l[0],r=l[1],i=l[2],c=0;if(o.some((function(a){return 0!==e[a]}))){for(s in r)t.o(r,s)&&(t.m[s]=r[s]);if(i)var u=i(t)}for(a&&a(l);c<o.length;c++)n=o[c],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(u)},l=self["webpackChunkrental_analysis_frontend"]=self["webpackChunkrental_analysis_frontend"]||[];l.forEach(a.bind(null,0)),l.push=a.bind(null,l.push.bind(l))}();var l=t.O(void 0,[504],(function(){return t(3620)}));l=t.O(l)})();
//# sourceMappingURL=app.5db5624f.js.map